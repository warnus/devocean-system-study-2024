# 개략적인 규모 추정

* 시스템 용량 / 성능 요구사항을 개략적으로 추정

## 2의 제곱수
* ASCII 문자 하나가 1바이트
* 1바이트 = 8비트
* | 2의 n 제곱 | 근사치                    | 설명  |
  |:--------|:-----------------------|:----|
  | 10      | 천 1000                 | 1KB |
  | 20      | 백만 1000000             | 1MB |
  | 30      | 10억 1000000000         | 1GB |
  | 40      | 1조 1000000000000       | 1TB |
  | 50      | 1000조 1000000000000000 | 1PB |


## 응답 지연값
* | 연산명                           | 시간    |
  |:------------------------------|:------|
  | L1 캐시참조                       | 0.5ns | 
  | 분기 예측 오류                      | 5ns   | 
  | L2 캐시참조                       | 7ns   |
  | 뮤텍스 락/언락                      | 100ns |
  | 주 메모리 참조                      | 100ns |
  | Zippy 1kb 압축                  | 10us  |
  | 1 Gbps 네트워크로 2KB 전송           | 10us  |
  | 메모리에서 1MB 순차적으로 읽기            | 250us |
  | 같은 데이터 센터 내에서 메시지 왕복 지연시간     | 500us |
  | 디스크 탐색                        | 10ms  |
  | 네트워크에서 1MB 씩 순차적으로 읽기         | 10ms  |
  | 디스크에서 1MB 씩 순차적으로 읽기          | 30ms  |
  | 한 패킷의 캘리포니아 - 네덜란드까지 왕복 지연 시간 | 150ms |
(1ms = 1000us = 1,000,000ns )

* 메모리는 빠르지만 디스크는 아직도 느리다
* 디스크 탐색은 가능한 피하라
* 단순한 압축 알고리즘은 빠르다.

## 가용성
* High Availability 고가용성
* % 로 표현하며 100%는 한 번도 중단된 적이 없음을 나타낸다.
* 대부분의 서비스는 99%-100% 사이의 값을 갖는다.
* SLA(Service Level Agreement) - 서비스 사업자와 고객 사이에 맺어진 합의를 의미한다.
  * 서비스 사업자가 제공하는 서비스의 가용기간(uptime)이 공식적으로 기술되어있다.
* | 가용률      | 하루당 장애시간 | 주당 장애시간  | 개월당 장애시간 | 연간 장애시간 |
  |:---------|:---------|:---------|:---------|:--------|
   | 99%      | 14.4분    | 1.68시간   | 7.31시간   | 3.65일   |
   | 99.9%    | 1.44분    | 10.08분   | 43.38분   | 8.77시간  |
   | 99.99%   | 8.64초    | 1.01분    | 4.38분    | 52.6분   |
   | 99.999%  | 864ms    | 6.05초    | 26.3초    | 5.26분   |
   | 99.9999% | 86.4ms   | 604.80ms | 2.63초    | 31.56초  |

## QPS와 저장소 요구량 추정
* 가정
  * 월간 능동사용자(mau) 는 3억명이다
  * 50%의 사용자가 트위터를 매일 사용한다
  * 평균적으로 각 사용자는 매일 2건의 트윗을 올린다
  * 미디어를 포함하는 트윗은 10%정도이다
  * 데이터는 5년간 보관한다
* 추정
  * QPS
    * 일간 능동 사용자(DAU) = 3억 * 50% = 1.5억
    * QPS = 1.5억 * 2 / 24 / 3600 = 약 3500
    * 최대 QPS = 2 * 3500 = 약 7000
  * 저장소 요구량
    * 평균트윗크기
      * tweet_id - 64byte
      * text - 140 byte
      * media - 1MB
      * 미디어 저장소 요구량 - 1.5억 * 2 * 10% * 1MB = 30TB / 일
      * 5년간 미디어를 보관하기 위한 저장소 요구량: 30TB * 365 * 5 = 약 55PB

## 팁
* 개략적인 규모 추정과 관계된 면접에서 중요한 것은 문제를 풀어나가는 절차다.
* 올바른 절차를 밟느냐가 결과를 내는 것 보다 중요하다.
  * 근사치를 활용하자.
  * 가정들은 적어두자
  * 단위를 붙여서 적어두자
  * QPS, Peek QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정하는 문제가 주로 나온다.
* 연습을 많이 하자.