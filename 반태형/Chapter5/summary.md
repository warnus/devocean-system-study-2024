# 안정 해시 설계

요청 또는 데이터를 서버에 균등하게 나누는 것이 중요

## 해시키 재배치 문제

* serverIndex = hash(key) % N(서버 수)
* 여기서 서버가 추가되거나 삭제될 때를 생각해보면 serverIndex 가 변하기 쉽다.

| 서버 | hash(key) |
|----|-----------|
| 0  | 0,4,8...  |
| 1  | 1,5,9...  |
| 2  | 2,6,10... |
| 3  | 3,7,11... |

인 상황에서 3번 서버가 죽고 난이후 키를 살펴보면

| 서버 | hash(key)       |
|----|-----------------|
| 0  | 0,**3,6,9**...  |
| 1  | 1,**4,7,10**... |
| 2  | 2,**5,8,11**... |

대부분의 키 값이 다른 서버로 매칭되면서 예시에서는 12개의 데이터중 9개의 매칭이 수정되고 캐시였으면 75% 가 캐시미스가 나게 될 것이다.

| 서버 | hash(key) |
|----|---------|
| 0  | 0,**5**,**10**... |
| 1  | 1,**6**,**11**... |
| 2  | 2,**7**...  |
| 3  | 3,**8**...  |
| 4  | **4**,**9**... | 

4번 서버가 추가된 경우 여기서도 대부분의 키가 다른 서버에 매핑되면서 미스가 발생하게 되는 것이다.
이를 해결하기 위해 안정해시가 필요하다.

## 안정 해시
* 하나의 링을 생각해보자.


## 가상 노드를 이용한 개선
* 