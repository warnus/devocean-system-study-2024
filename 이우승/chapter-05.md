
# 안정 해시 설계


## 해시 키 재배치(rehash) 문제

- N개의 '캐시 서버'에 부하를 균등하게 나누는 보편적 방법은 다음과 같은 해시 함수를 사용하는 것
```
serverIndex = hash(key) % N (N은 서버의 개수)
```

![](/이우승/assets/ch-05/ch05_01.png)

- hash(key0) % 4 = 1 -> 서버 1로 부터 데이터를 가져옴

![](/이우승/assets/ch-05/ch05_02.jpeg)

- 위 해시 함수를 사용하면 키가 위 그림과 같이 균등하게 분포됨
- 하지만, 서버 개수가 추가되거나 장애등으로 인해 감소하는 경우 위와 같이 균등하게 분포되지 못 하는 문제가 있음

![](/이우승/assets/ch-05/ch05_03.jpeg)

- 위에서 보는 것과 같이 Server1이 장애로 정상동작하지 못하는 경우 클라이언트가 엉뚱한 곳에서 데이터를 찾게 되어 대규모 캐시 미스가 발생하게 됨

## 안정 해시(Consistent hash)

- 안정 해시는 해시 테이블 크기가 조정될 때 평균적으로 k/n 개의 키만 재배치하는 해시 기술
- k는 키의 개수, n은 슬롯(slot)의 개수


로드밸런서와 안정 해시의 차이는 뭘까?





## 참고

- https://jiwondev.tistory.com/299